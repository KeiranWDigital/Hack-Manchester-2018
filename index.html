<!DOCTYPE html >

<head>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>Travel Badger</title>
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        #map {
            height: 100%;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <!-- Achievement modals--------------------------------->
    <link rel="stylesheet" type="text/css" href="Pages/style.css">
    <div class="modal fade" id="Badge1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">First Badger!</h4>
                </div>



                <div class="modal-body">
                    <p>Well look at you! Congratulations on earning your first badger!
                        <br><br>
                        Keep on exploring to collect the sett ;)
                        <br><br>
                        <img class="center-block img-responsive img-circle" src="Images/1st achievement.png" alt="First Badge">
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Badge2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Second Badger!</h4>
                </div>

                </head>

                <div class="modal-body">
                    <p>Erm wait...this is a demo. You aren't meant to get two badgers.
                        <br><br>
                        Please, don't break it...
                        <br><br>
                        <img class="center-block img-circle" src="Images/2nd achievement.png" alt="Second Badge">
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
    </div>

    <div class="modal fade" id="Badge3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">

            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Snake!</h4>
                </div>



                <div class="modal-body">
                    <p>Snake!!
                        <br><br>
                        Better luck next time...
                        <br><br>
                        <img class="center-block" src="Images/Snake.png" alt="Snake">
                    </p>
                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>
    <!--Map Scripts-->
    <div id="map"></div>

    <script>
        // Find the right method, call on correct element
        function launchFullScreen(element) {
            if (element.requestFullScreen) {
                element.requestFullScreen();
            } else if (element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullScreen) {
                element.webkitRequestFullScreen();
            }
        }

        // Launch fullscreen for browsers that support it!
        launchFullScreen(document.documentElement); // the whole page



        var delMarker = function (id) {
            marker = markers[id];
            marker.setMap(null);
        }
        var image = {
            url: 'https://85bf8b91.ngrok.io/Hack-Manchester-2018/Images/badger-pngrepo-com.png',

        };

        var image2 = {
            url: 'https://85bf8b91.ngrok.io/Hack-Manchester-2018/Images/badger-pngrepo-com(1).png',

        };

        var customLabel = {
            True: {
                label: 'A',
                icon: image
            },
            null: {
                label: 'B',
                icon: image2
            }
        };

        function initMap() {


            var map = new google.maps.Map(document.getElementById('map'), {
                center: new google.maps.LatLng(53.4771396, -2.2546459),
                zoom: 17,
                tilt: 45,
                heading: 90,
                rotateControl: true,
                styles: [
                    {
                        "featureType": "administrative",
                        "elementType": "all",
                        "stylers": [
                            {
                                "saturation": "-100"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative.province",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "all",
                        "stylers": [
                            {
                                "saturation": -100
                            },
                            {
                                "lightness": 65
                            },
                            {
                                "visibility": "on"
                            }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "all",
                        "stylers": [
                            {
                                "saturation": -100
                            },
                            {
                                "lightness": "50"
                            },
                            {
                                "visibility": "off"
                            }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "all",
                        "stylers": [
                            {
                                "saturation": "-100"
                            }
                        ]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "all",
                        "stylers": [
                            {
                                "visibility": "simplified"
                            }
                        ]
                    },
                    {
                        "featureType": "road.arterial",
                        "elementType": "all",
                        "stylers": [
                            {
                                "lightness": "30"
                            }
                        ]
                    },
                    {
                        "featureType": "road.local",
                        "elementType": "all",
                        "stylers": [
                            {
                                "lightness": "40"
                            }
                        ]
                    },
                    {
                        "featureType": "transit",
                        "elementType": "all",
                        "stylers": [
                            {
                                "saturation": -100
                            },
                            {
                                "visibility": "simplified"
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [
                            {
                                "hue": "#ffff00"
                            },
                            {
                                "lightness": -25
                            },
                            {
                                "saturation": -97
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels",
                        "stylers": [
                            {
                                "lightness": -25
                            },
                            {
                                "saturation": -100
                            }
                        ]
                    }
                ],
                disableDefaultUI: true,
                clickableIcons: false

            });

            draw_current()
            setInterval(draw_current, 5000)
            var markers_list = [];



            function draw_current() {


                console.log("Location")
                // Try HTML5 geolocation.
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        var pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude

                        };
                        console.log(pos.lat);
                        console.log(pos.lng);
                        var current_marker = new google.maps.Marker({
                            position: pos,
                            title: "Hello World!",
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 10,
                                strokeWeight: 1,
                                fillOpacity: 0.8,
                                fillColor: 'blue',

                            },
                            id: 1


                        });

                        markers_list.push(current_marker);

                        console.log(markers_list[0])
                        console.log(current_marker.id)
                        // To add the marker to the map, call setMap();
                        current_marker.setMap(map);
                        setTimeout(function () { current_marker.setMap(null); }, 5000);
                        //set center of map to current location 
                        map.setCenter(new google.maps.LatLng(pos.lat, pos.lng));
                    }, function () {
                        handleLocationError(true, infoWindow, map.getCenter());
                    });
                } else {
                    // Browser doesn't support Geolocation
                    handleLocationError(false, infoWindow, map.getCenter());
                }


                var infoWindow = new google.maps.InfoWindow;



            }

            function remove(current_marker) {


            }



            // Change this depending on the name of your PHP or XML file
            downloadUrl('DB_access.php', function (data) {
                var xml = data.responseXML;
                var markers = xml.documentElement.getElementsByTagName('marker');
                Array.prototype.forEach.call(markers, function (markerElem) {
                    var id = markerElem.getAttribute('id');
                    var name = markerElem.getAttribute('localstoragename');
                    var address = "Pages/" + markerElem.getAttribute('address');
                    var type = localStorage.getItem(name);
                    var point = new google.maps.LatLng(
                        parseFloat(markerElem.getAttribute('lat')),
                        parseFloat(markerElem.getAttribute('lng')));

                    var infowincontent = document.createElement('div');
                    var strong = document.createElement('strong');
                    strong.textContent = name
                    infowincontent.appendChild(strong);
                    infowincontent.appendChild(document.createElement('br'));

                    var text = document.createElement('text');
                    text.textContent = address
                    infowincontent.appendChild(text);
                    var icon = customLabel[type] || {};
                    var marker = new google.maps.Marker({
                        map: map,
                        position: point,
                        icon: icon.icon
                    });
                    marker.addListener('click', function () {
                        window.location = address
                    });
                });
            });
        }

        function changeMarkerPosition(marker, lat, lng) {
            var latlng = new google.maps.LatLng(lat, lng);
            mark.setPosition(latlng);
        }

        function downloadUrl(url, callback) {
            var request = window.ActiveXObject ?
                new ActiveXObject('Microsoft.XMLHTTP') :
                new XMLHttpRequest;

            request.onreadystatechange = function () {
                if (request.readyState == 4) {
                    request.onreadystatechange = doNothing;
                    callback(request, request.status);
                }
            };

            request.open('GET', url, true);
            request.send(null);
        }

        function doNothing() { }
    </script>
    <script>
        console.log(localStorage.getItem("Sum"))
        if (localStorage.getItem("Sum") == null) {
            localStorage.setItem("Sum", 0)
            window.location = "Pages/Instructions.html"

        }

        if (localStorage.getItem("Sum") == 1 && localStorage.getItem("1") == null) {
            console.log("Badge1")
            $("#Badge1").modal('show');
            localStorage.setItem("1", 1)

        }

        if (localStorage.getItem("Sum") == 2 && localStorage.getItem("2") == null) {
            console.log("Badge2")
            $("#Badge2").modal('show');
            localStorage.setItem("2", 1)

        }

         if (localStorage.getItem("Sum") == 3 && localStorage.getItem("3") == null) {
            console.log("Badge3")
            $("#Badge3").modal('show');
            localStorage.setItem("3", 1)

        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeRmfR_ykc83fzYlkT8JT7zb3xtxyAJwE&callback=initMap">
    </script>


    <!--Badge modals----------------------------------------------------------------------------------------------->



</body>

</html>